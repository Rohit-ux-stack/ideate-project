<aside class="fixed top-0 left-0 w-64 h-full bg-[#0F172A] border-r border-slate-800 flex flex-col z-50">
    <div class="h-20 flex items-center px-8 border-b border-slate-800 shrink-0">
        <h1 class="text-2xl font-bold italic text-blue-500 tracking-wider">IDEATE</h1>
    </div>

    <nav class="flex-1 overflow-y-auto py-6 flex flex-col space-y-1 px-3 custom-scrollbar">
        <a href="/?feed=home" class="flex items-center space-x-3 px-4 py-3 rounded-xl transition-all <%= (typeof currentFeed !== 'undefined' && currentFeed === 'home') ? 'bg-blue-600/10 text-blue-400' : 'text-slate-400 hover:bg-slate-800/50 hover:text-white' %>">
            <i class="ri-home-4-fill text-xl"></i> <span class="font-medium">My Feed</span>
        </a>
        <a href="/?feed=explore" class="flex items-center space-x-3 px-4 py-3 rounded-xl transition-all <%= (typeof currentFeed !== 'undefined' && currentFeed === 'explore') ? 'bg-blue-600/10 text-blue-400' : 'text-slate-400 hover:bg-slate-800/50 hover:text-white' %>">
            <i class="ri-compass-3-line text-xl"></i> <span class="font-medium">Explore Random</span>
        </a>

        <div class="pt-6 pb-2 px-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Topics</div>
        <a href="/?category=Startup" class="flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all"><i class="ri-rocket-line text-xl"></i> <span>Startup</span></a>
        <a href="/?category=Tech" class="flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all"><i class="ri-computer-line text-xl"></i> <span>Tech Upgrade</span></a>
        <a href="/?category=Social" class="flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all"><i class="ri-shake-hands-line text-xl"></i> <span>Social Impact</span></a>
        
        <div class="pt-6 pb-2 px-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Community</div>
        <a href="/leaderboard" class="flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800/50 hover:text-yellow-400 transition-all">
            <i class="ri-trophy-line text-xl"></i> <span>Hall of Fame</span>
        </a>
        <a href="/info/guidelines" class="flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all">
            <i class="ri-shield-check-line text-xl"></i> <span>Guidelines</span>
        </a>

        <div class="pt-6 pb-2 px-4 text-xs font-bold text-slate-500 uppercase tracking-wider">Support</div>
        <a href="/info/how-to-use" class="flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all">
            <i class="ri-question-line text-xl"></i> <span>How to Use</span>
        </a>
        <a href="/info/faq" class="flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all">
            <i class="ri-chat-1-line text-xl"></i> <span>FAQ</span>
        </a>

        <% if (user) { %>
            <div class="pt-6 pb-2 px-4 text-xs font-bold text-slate-500 uppercase tracking-wider">My Library</div>
            <a href="/bookmarks" class="flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all"><i class="ri-bookmark-3-line text-xl"></i> <span>Bookmarks</span></a>
            <a href="/activity" class="flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all"><i class="ri-history-line text-xl"></i> <span>My Activity</span></a>
            <a href="/analytics" class="flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all"><i class="ri-bar-chart-line text-xl"></i> <span>Analytics</span></a>
            <a href="/notifications" class="flex items-center space-x-3 px-4 py-3 rounded-xl text-slate-400 hover:bg-slate-800/50 hover:text-white transition-all relative">
                <i class="ri-notification-3-line text-xl"></i> <span>Notifications</span>
                <% if(user.notifications && user.notifications.some(n => !n.read)) { %>
                    <span class="w-2 h-2 bg-red-500 rounded-full absolute left-9 top-4 border-2 border-[#0F172A]"></span>
                <% } %>
            </a>
        <% } %>

        <div class="mt-auto pt-8 px-4 pb-4">
             <div class="flex flex-wrap gap-x-3 gap-y-2 text-[11px] font-bold text-slate-600">
                <a href="/info/about" class="hover:text-slate-400 transition">About</a>
                <a href="/info/contact" class="hover:text-slate-400 transition">Contact</a>
                <a href="/info/privacy" class="hover:text-slate-400 transition">Privacy</a>
                <a href="/info/terms" class="hover:text-slate-400 transition">Terms</a>
            </div>
            <div class="text-[10px] text-slate-700 mt-2 font-mono">Â© 2026 Ideate Inc.</div>
        </div>
    </nav>

    <% if (user) { %>
        <div class="p-4 border-t border-slate-800 bg-[#0F172A] shrink-0">
            <div class="flex items-center justify-between group">
                <a href="/user/<%= user._id %>" class="flex items-center space-x-3 flex-1 min-w-0">
                     <% if (user.image) { %>
                         <img src="<%= user.image %>" class="w-10 h-10 rounded-full object-cover border-2 border-slate-700 group-hover:border-blue-500 transition shrink-0">
                     <% } else { %>
                         <div class="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center text-white font-bold border-2 border-slate-700 group-hover:border-blue-500 transition shrink-0">
                             <%= user.displayName.charAt(0) %>
                         </div>
                     <% } %>
                     
                     <div class="overflow-hidden">
                         <p class="text-sm font-bold text-white group-hover:text-blue-400 transition truncate"><%= user.displayName %></p>
                         <p class="text-[11px] text-blue-400 font-medium truncate">@<%= user.username %></p>
                     </div>
                </a>
                
                <a href="/logout" class="p-2 text-slate-500 hover:text-red-400 transition" title="Logout">
                    <i class="ri-logout-box-r-line text-lg"></i>
                </a>
            </div>
        </div>
    <% } %>
</aside>

<script>
    async function checkNotifications() {
        try {
            const res = await fetch('/api/notifications/check');
            const data = await res.json();
            const navLink = document.querySelector('a[href="/notifications"]');
            if(navLink) {
                let dot = navLink.querySelector('span.bg-red-500');
                if (data.count > 0) {
                    if (!dot) {
                        dot = document.createElement('span');
                        dot.className = 'w-2 h-2 bg-red-500 rounded-full absolute left-9 top-4 border-2 border-[#0F172A]';
                        navLink.appendChild(dot);
                    }
                } else {
                    if (dot) dot.remove();
                }
            }
        } catch(e) {}
    }
    setInterval(checkNotifications, 10000);

    window.toggleFollow = async function(btn, userId) {
        if(typeof event !== 'undefined') { event.preventDefault(); event.stopPropagation(); }
        try {
            const res = await fetch(`/follow/${userId}`);
            const data = await res.json();
            if(data.success) {
                const span = btn.querySelector('span') || btn; 
                const icon = btn.querySelector('i');
                if(data.isFollowing) {
                    if(span !== btn) span.innerText = 'Unfollow';
                    if(icon) icon.className = 'ri-user-unfollow-line';
                    btn.classList.add('bg-slate-700', 'text-slate-300');
                    btn.classList.remove('bg-blue-600', 'text-white');
                } else {
                    if(span !== btn) span.innerText = 'Follow';
                    if(icon) icon.className = 'ri-user-add-line';
                    btn.classList.add('bg-blue-600', 'text-white');
                    btn.classList.remove('bg-slate-700', 'text-slate-300');
                }
                const countSpan = document.getElementById('followerCount');
                if(countSpan) countSpan.innerText = data.newCount;
            } else if(data.error === "Login required") {
                window.location.href = "/login";
            }
        } catch(err) {}
    }
</script>