<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head') %>
<body class="bg-[#0F172A] text-slate-200 min-h-screen flex">

    <%- include('../partials/sidebar') %>

    <main class="ml-64 flex-1">
        <header class="h-20 border-b border-slate-800 flex items-center justify-between px-8 sticky top-0 bg-[#0F172A]/80 backdrop-blur-md z-30">
            <div class="w-1/3">
                <input type="text" id="searchInput" onkeyup="filterIdeas()" placeholder="Search..." 
                       class="w-full bg-slate-900 border border-slate-700 rounded-full py-2 px-6 focus:outline-none focus:border-blue-500 text-sm">
            </div>

            <% if (user) { %>
                <button onclick="document.getElementById('postModal').classList.replace('hidden', 'flex')" 
                        class="<%= theme.bg %> <%= theme.bgHover %> text-white px-6 py-2 rounded-full font-bold shadow-lg transition">
                    + Post Idea
                </button>
            <% } %>
        </header>

        <div class="p-8">
            <div class="flex justify-between items-end mb-6">
                <h2 class="text-2xl font-bold">
                    <%= typeof pageTitle !== 'undefined' ? pageTitle : 'Trending Innovations' %>
                </h2>
            </div>
            
            <div id="ideaGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <% ideas.forEach(idea => { %>
                    <div class="idea-card bg-slate-900 border border-slate-800 p-6 rounded-2xl hover:border-blue-500/40 transition group relative"
                         data-search="<%= idea.title.toLowerCase() %>">

                        <div class="flex justify-between items-start mb-4">
                            <span class="px-3 py-1 <%= theme.lightBg %> <%= theme.textLight %> text-[10px] font-bold rounded-full uppercase tracking-wider">
                                <%= idea.category %>
                            </span>

                            <a href="/post/<%= idea._id %>/bookmark" class="text-slate-600 hover:text-yellow-400 transition">
                                â˜…
                            </a>
                        </div>

                        <div onclick="window.location.href='/post/<%= idea._id %>'" class="cursor-pointer">

                            <% if(idea.images && idea.images.length > 0) { %>
                                <div class="w-full h-40 rounded-xl overflow-hidden mb-4 border border-slate-800">
                                    <img src="<%= idea.images[0].src %>" class="w-full h-full object-cover">
                                </div>
                            <% } %>

                            <h3 class="text-lg font-bold group-hover:text-blue-400 transition mb-2">
                                <%= idea.title %>
                            </h3>

                            <p class="text-slate-400 text-sm mb-4 line-clamp-2">
                                <%= idea.description %>
                            </p>
                        </div>
                        
                        <div class="flex items-center justify-between mt-6 pt-4 border-t border-slate-800">
                            <div class="flex items-center space-x-4">
                                <a href="/post/<%= idea._id %>/raise" class="flex items-center space-x-1 text-slate-400 hover:text-green-400 transition">
                                    <span>â–²</span>
                                    <span class="text-sm"><%= (idea.upvotes || []).length %></span>
                                </a>
                                <a href="/post/<%= idea._id %>" class="flex items-center space-x-1 text-slate-400 hover:text-blue-400 transition">
                                    <span>ðŸ’¬</span>
                                    <span class="text-sm"><%= (idea.comments || []).length %></span>
                                </a>
                            </div>

                            <span class="text-[10px] font-bold text-yellow-500 bg-yellow-500/10 px-2 py-1 rounded border border-yellow-500/10 uppercase">
                                <%= idea.status %>
                            </span>
                        </div>
                    </div>
                <% }) %>
            </div>
        </div>
    </main>

    <%- include('../partials/postModal') %>

    <script>
        function filterIdeas() {
            const val = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.idea-card').forEach(card => {
                card.style.display = card.getAttribute('data-search').includes(val) ? "block" : "none";
            });
        }
    </script>
</body>
</html>
